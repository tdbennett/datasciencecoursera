---
title: "Severe Weather Event Analysis"
author: "Tell Bennett"
date: "Monday, April 20, 2015"
output: html_document
---
    Title: Your document should have a title that briefly summarizes your data analysis

    Synopsis: Immediately after the title, there should be a synopsis which describes and summarizes your analysis in at most 10 complete sentences.

### Synopsis

10 sentences or less.



### Data Processing

```{r options, echo = FALSE}
setwd("./ReproducibleResearch/Proj2/")
options(dplyr.max_print = 10)
options(dplyr.min_print =  5)
```

1) Loading packages

```{r loadpackages, echo = FALSE}
library(dplyr)
library(lubridate)
library(ggplot2)
library(stringr)
```

2) Loading the raw data

```{r dataload, cache=TRUE}
## Download the data 
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(url, destfile = "stormdata.bz2")

## Document the download time
downloadtime <- date()
downloadtime
## [1] "Tue Apr 21 15:30:23 2015"
```

3) Read the data into R
```{r dataread, cache=TRUE}
stormdata <- read.table("stormdata.bz2", sep = ",", header=TRUE, stringsAsFactors=FALSE, nrows = 1000)
```

4) Exploring the raw data to facilitate cleaning
```{r explore1}
dim(stormdata)
glimpse(stormdata)
summary(stormdata)
```

5) Extract the necessary variables
```{r clean1}
stormdata <- transmute(stormdata,
        id = REFNUM,
        evtype = as.factor(EVTYPE),
        state = as.factor(STATE),
        begindate = BGN_DATE,
        enddate = END_DATE,
        deaths = FATALITIES,
        injuries = INJURIES,
        propdmg = PROPDMG,
        propdmgexp = PROPDMGEXP,
        cropdmg = CROPDMG,
        cropdmgexp = CROPDMGEXP)

stormdata2 <- str_split_fixed(stormdata$begindate, pattern = " ", 2)
stormdata3 <- str_split_fixed(stormdata$enddate, " ", 2)

stormdata <- cbind(stormdata, stormdata2[,1],stormdata3[,1])

stormdata <- stormdata %>%
        select(-begindate,-enddate) %>%
        mutate(begindate = mdy(stormdata2[,1]), enddate = stormdata3[,1]) 

stormdata <- stormdata[,c(1:9,12:13)]

rm(stormdata2)
rm(stormdata3)
```


Further exploratory analysis - event variable
```{r explore2}
table(stormdata$evtype, useNA = "ifany")
##    HAIL   TORNADO TSTM WIND 
      171       363       466 

byyear <- stormdata %>%
    group_by(year(enddate),evtype) %>%
    summarize(count = sum())
```


3) Reference documentation
Put in a hyperlink to https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf

FAQ location 
https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf

Years for each event type
http://www.ncdc.noaa.gov/stormevents/details.jsp

Field details
ftp://ftp.ncdc.noaa.gov/pub/data/swdi/stormevents/csvfiles/Storm-Data-Export-Format.docx

### Results


When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
summary(cars)
```

You can also embed plots, for example:

```{r, echo=FALSE}
plot(cars)
```

