---
title: "Fuel Consumption with Automatic versus Manual Transmissions"
author: "T. Bennett"
date: "August 23, 2015"
output: pdf_document
---



Executive Summary
-----------------
This document describes an analysis of the U.S. National Oceanic and Atmospheric Administration (NOAA)'s Storm Events database from 1950 to November 2011.  The goals of the analysis were to assess the 1) population health and 2) economic impact of severe storm events.

As one might expect based on geography, the types of storm events in each U.S. state vary widely.  Government officials and planners need to account for local events in their use of this analysis. 
    
Heat events cause the most deaths and injuries per event.  Tropical depressions/storms and hurricanes cause nearly as many injuries per event, but fewer deaths.  

Overall, flood events cause the most property damage, and are close behind drought events in causing the most crop damage.  Tropical storms/depressions and hurricanes cause the most property and crop damage per storm event, and the second-most property damage overall, despite the fact that they are rare.  Other rainstorm and tornado events calso cause significant property damage, and winter storms also cause major crop damage.



Data Processing
---------------

```{r options, echo = FALSE}
options(dplyr.max_print = 10)
options(dplyr.min_print =  5)
```

  

1) Loading packages

```{r loadpackages, echo = TRUE, results="hide", message=FALSE}
library(dplyr)
library(ggplot2)
library(stringr)
library(xtable)
library(GGally)
library(car)
library(lmtest)
```


2) Loading the raw data

```{r dataload, cache=TRUE}
## load and inspect the data 
data(mtcars)
str(mtcars)
glimpse(mtcars)
```


This analysis is based on the `mtcars` dataset included in the `datasets` package in base R. 
It contains data on the 1973-74 models of 32 different automobiles including fuel consumption
and 10 aspects of automobile design. Total 32 rows and 11 fields, no missing data.


  
Exploratory Data Analyses 
-------------------------

Miles per gallon is the primary outcome.

```{r eda1, cache=TRUE}
with(mtcars, boxplot(mpg, main = "Miles per gallon, overall"))
```

```{r labeltrtype, results = "asis"}
mtcars <- mtcars %>%
    mutate(trtype = factor(am, labels = c("Automatic", "Manual"))) %>%
    select(-am)
           
tab <- xtable(table(mtcars$trtype))
tab
```

Transmission type is the primary predictor of interest. 13 of 32(`r 13/32`) have a manual transmission 
and 19 of 32(`r 19/32`) have a manual transmission.

```{r bivplot, cache=TRUE}
boxplot(mpg ~ trtype, main = "MPG, by transmission type", data = mtcars)
```

A bivariate plot does suggest that manual transmissions are associated with better
gas mileage. 
```{r ttest}
res <- t.test(mpg ~ trtype, var.equal=FALSE, data = mtcars)
```
A t-test of `mpg` using unequal variances bears that out: cars with automatic transmissions get `r res$estimate[1]` 
miles per gallon and cars with manual transmissions get `r res$estimate[2]` miles per gallon,
t-test _p_ = `r res$p.value`.



Potential Confounders
---------------------
  
Several other variables might confound the Transmission Type - Mileage relationship. 
Based on my working knowledge of automobile engines, any of the other 9 variables in 
the `mtcars` dataset might be hypothesized to be important. The below bivariate plots 
of the 9 variables against `mpg` suggest that any of them could reasonably 
be a predictor. 
```{r bivariateplots, cache = TRUE}
par(mfrow = c(3,3))
boxplot(mpg ~ cyl, main = "MPG, by # of Cylinders", data = mtcars, xlab = "Cylinders")
with(mtcars, plot(disp, mpg, main = "MPG, by Displacement", xlab = "Displacement (cubic in.)"))
with(mtcars, plot(hp, mpg, main = "MPG, by Horsepower", xlab = "Horsepower"))
with(mtcars, plot(drat, mpg, main = "MPG, by Rear Axle ratio", xlab = "Rear Axle Ratio"))
with(mtcars, plot(wt*1000, mpg, main = "MPG, by Vehicle Weight", xlab = "Weight (pounds)"))
with(mtcars, plot(qsec, mpg, main = "MPG, by 1/4 mile time", xlab = "1/4 mile time (seconds)"))
boxplot(mpg ~ gear, main = "MPG, by # of Forward Gears", data = mtcars, xlab = "Forward Gears")
boxplot(mpg ~ carb, main = "MPG, by # of Carburetors", data = mtcars, xlab = "Carburetors")
par(mfrow = c(1,1))
```


To avoid including two covariates that are either highly correlated themselves or highly correlated
with the primary predictor of interest, I created the `pairs` plot below.
```{r pairsplot, cache = TRUE}
p <- ggpairs(mtcars, columns = 2:11, lower = list(continuous = "smooth"), params = c(method = "loess"))
p
```


Number of cylinders, weight, and displacement are highly correlated (which makes sense, I suppose).
I decided to include displacement and weight in the model selection process because 
they are continuous variables that reflects physical properties of the car. Number of cylinders is
also reasonably highly correlated with transmission type, our primary predictor of interest.
Horsepower is also highly correlated with  number of cylinders, but not quite as highly correlated with the other variables, so I will consider it during model selection.


Linear Regression including all potential predictors (Model 1)
--------------------------------------------------------------

```{r fit1, echo = FALSE}
mtcars <- mtcars %>%
    select(-cyl)   ### removing horsepower and number of cylinders per the above

fit <- lm(mpg ~ I(1 * (trtype == 'Manual')) + disp + drat + wt + qsec + vs + gear + carb + hp, data = mtcars)
summary(fit)
```

In this full model, we estimate that cars with manual transmissions get 2.6(95% CI x to y) 
more miles per gallon than cars with automatic transmissions after adjustment for 8 other
variables. However, this comparison is not statistically significant. Weight is the 
variable that appears to potentially be an important predictor of fuel consumption,
as each 1000 pounds of additional weight is associated with 3.7(95% CI x to y) fewer 
miles per gallon, _p_ = []. This model fits the data reasonably well, as the adjusted R^2
is [0.82].


Assessing variance inflation
----------------------------

```{r fit1vif}
vif(fit)
```

Our concern about the correlation between weight, horsepower, and displacement appears
well-founded, as those variables have the highest variance inflation factors. Horsepower and 
displacement were poor predictors of fuel consumption in the full model, therefore we
will remove those variables and re-fit the model.

Model without horsepower or displacement (Model 2)
--------------------------------------------------

```{r fit2}
fit2 <- lm(mpg ~ I(1 * (trtype == 'Manual')) + drat + wt + qsec + vs + gear + carb, data = mtcars)
summary(fit2)
vif(fit2)
```

Model 2 still fits the data reasonably well (adjusted R^2 is the same, [0.82]), but
the variance inflation factors for the variables remaining in the model are now similar. The estimated
effect of a manual transmission has changed only marginally (2.5 mpg higher instead of 2.6) and
continues to be not statistically significant. The weight effect is slightly smaller (3.0 instead
of 3.7), but is now statistically significant. This model is a candidate for a final model.


Highly parsimonious model (Model 3)
-----------------------------------

Because vehicle weight was the only significant predictor in either previous model, I considered
a model containing only transmission type and vehicle weight.

```{r fit3}
fit3 <- lm(mpg ~ I(1 * (trtype == 'Manual')) + wt, data = mtcars)
summary(fit3)
lrtest(fit2,fit3)
```

This model is likely too parsimonious, as the adjusted R^2 decreased to [0.74]. As
you might expect, a nested likelihood ratio (LR) test comparing the highly parsimonious model 
to the model without horsepower or displacement was significant, _p_ = 0.002. Interestingly,
transmission type has no association with fuel consumption in this model.


Adding variables back to the parsimonious model (Model 4)
---------------------------------------------------------

Of the remaining variables, quarter mile time (perhaps a proxy for several vehicle and tuning properties)
and number of carburetors were the closest to significance in the previous models.
Therefore, we fit a model that added them back to the parsimious model.
```{r fit4etc}
fit4 <- lm(mpg ~ I(1 * (trtype == 'Manual')) + wt + carb + qsec, data = mtcars)
summary(fit4)
lrtest(fit3,fit4)
lrtest(fit4,fit2)
vif(fit4)
```

Model 4 has the best adjusted R^2 of any considered thus far ([0.84)]). It also has
no difference by LR test from Model 2, which contained several more variables. The 
variance inflation factors of Model 4 are the lowest of any model evaluated thus far.

Final Model (Model 4)
---------------------

We estimate that a car with a manual transmission gets 3.5(95% CI x to y) more miles per gallon 
than a car with an automatic transmission after adjustment for vehicle weight, number of
carburetors, and quarter mile time. 


  

  

  
  
 

  


  
  
  
  


  
  


  

  
 




